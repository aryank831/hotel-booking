<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Step 2 - Enter Details</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body class="bg-gray-100 p-6">

  <div class="max-w-xl mx-auto bg-white p-6 rounded-xl shadow-lg">
    <h2 class="text-2xl font-bold mb-4">Enter Your Details</h2>

    <div class="grid grid-cols-1 gap-4">
      <input type="text" id="name" class="border p-2 rounded" placeholder="Full Name" />
      <input type="tel" id="phone" class="border p-2 rounded" placeholder="Phone Number" />
      <input type="email" id="email" class="border p-2 rounded" placeholder="Email" />

      <div class="grid grid-cols-2 gap-4 mt-4">
        <button
          onclick="payNow()"
          class="bg-green-600 text-white py-2 rounded hover:bg-green-700"
        >
          Pay Now
        </button>

        <button
          onclick="payLater()"
          class="bg-blue-600 text-white py-2 rounded hover:bg-blue-700"
        >
          Pay on Check-in
        </button>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const bookingDetails = {
      checkin: params.get('checkin'),
      checkout: params.get('checkout'),
      roomType: params.get('roomType'),
      rooms: params.get('rooms'),
      guests: params.get('guests')
    };

    function getCustomerDetails() {
      const name = document.getElementById("name").value;
      const phone = document.getElementById("phone").value;
      const email = document.getElementById("email").value;

      if (!name || !phone || !email) {
        alert("Please fill all details");
        return null;
      }

      return { name, phone, email };
    }

    function payNow() {
      const customer = getCustomerDetails();
      if (!customer) return;

      const options = {
        key: "rzp_test_YOURKEYHERE", // Replace with your Razorpay Test Key
        amount: 10000, // Amount in paise (e.g., â‚¹100 = 10000 paise)
        currency: "INR",
        name: "Hotel MG Grand",
        description: "Hotel Booking",
        handler: function (response) {
          alert("Payment Successful! ID: " + response.razorpay_payment_id);

          const bookingData = {
            ...bookingDetails,
            ...customer,
            paymentStatus: "Paid"
          };
          sendToGoogleSheets(bookingData);
        },
        prefill: {
          name: customer.name,
          email: customer.email,
          contact: customer.phone
        },
        notes: bookingDetails,
        theme: { color: "#0f766e" }
      };

      const rzp = new Razorpay(options);
      rzp.open();
    }

    function payLater() {
      const customer = getCustomerDetails();
      if (!customer) return;

      const bookingData = {
        ...bookingDetails,
        ...customer,
        paymentStatus: "Pay on Check-in"
      };

      sendToGoogleSheets(bookingData);
      alert("Booking saved! Please pay at check-in.");
    }

    async function sendToGoogleSheets(bookingData) {
      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbzVP5-vAX4g0YnV0ELtrqPV5HOd8FoeP6uJgaTHMpRDqFNpP6Ly_V9dBFqCIeSA871E/exec", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(bookingData)
        });

        if (response.ok) {
          console.log("Data saved to Google Sheets!");
        } else {
          console.error("Error saving to Google Sheets");
          alert("Failed to save data.");
        }
      } catch (error) {
        console.error("Error:", error);
        alert("Failed to save data. Please try again.");
      }
    }
  </script>

</body>
</html>
